# ===================================================================\n# Reset Performance Counters Script\n# File: reset-performance.ps1\n# Author: jomardyan\n# Description: Rebuilds performance counters and monitoring\n# Version: 1.0.0\n# ===================================================================\n\n#Requires -Version 5.0\n#Requires -RunAsAdministrator\n\nparam([switch]$Silent, [switch]$CreateBackup = $true, [switch]$Force)\n\n$scriptPath = Split-Path -Parent $MyInvocation.MyCommand.Definition\nImport-Module (Join-Path $scriptPath \"ReSetUtils.psm1\") -Force\n\n$operationName = \"Performance Counters Reset\"\n\ntry {\n    Assert-AdminRights\n    $operation = Start-ReSetOperation -OperationName $operationName\n    \n    # Rebuild performance counter registry\n    Write-ProgressStep -StepName \"Rebuilding performance counters\" -CurrentStep 1 -TotalSteps 5\n    try {\n        $null = & lodctr /R 2>&1\n    } catch {
                # Silently continue - non-critical operation
            }\n    \n    # Reset WMI performance classes\n    Write-ProgressStep -StepName \"Resetting WMI performance classes\" -CurrentStep 2 -TotalSteps 5\n    try {\n        $null = & winmgmt /clearadap 2>&1\n        $null = & winmgmt /kill 2>&1\n        $null = & winmgmt /unregserver 2>&1\n        $null = & winmgmt /regserver 2>&1\n        $null = & winmgmt /resyncperf 2>&1\n    } catch {
                # Silently continue - non-critical operation
            }\n    \n    # Reset Event Tracing for Windows\n    Write-ProgressStep -StepName \"Resetting ETW sessions\" -CurrentStep 3 -TotalSteps 5\n    try {\n        Get-EtwTraceSession | Stop-EtwTraceSession -ErrorAction SilentlyContinue\n    } catch {
                # Silently continue - non-critical operation
            }\n    \n    # Clear performance logs\n    Write-ProgressStep -StepName \"Clearing performance logs\" -CurrentStep 4 -TotalSteps 5\n    $perfLogsPath = \"$env:SystemRoot\\System32\\PerfLogs\"\n    if (Test-Path $perfLogsPath) {\n        Remove-Item -Path \"$perfLogsPath\\*\" -Recurse -Force -ErrorAction SilentlyContinue\n    }\n    \n    # Restart performance-related services\n    Write-ProgressStep -StepName \"Restarting performance services\" -CurrentStep 5 -TotalSteps 5\n    $perfServices = @(\"PerfHost\", \"Winmgmt\", \"BITS\")\n    foreach ($service in $perfServices) {\n        Restart-WindowsService -ServiceName $service\n    }\n    \n    Write-ReSetLog \"Performance counters reset completed successfully\" \"SUCCESS\"\n    Complete-ReSetOperation -OperationInfo $operation -Success $true\n}\ncatch {\n    Complete-ReSetOperation -OperationInfo $operation -Success $false -ErrorMessage $_.Exception.Message\n    throw\n}
